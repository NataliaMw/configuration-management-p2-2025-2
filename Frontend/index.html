<!DOCTYPE html>
<html lang="es">
<head>
    <title>Lista de Tareas</title>
    <style>
        .completed {
            text-decoration: line-through;
            color: grey;
        }
    </style>
</head>
<body>

    <h1>Tareas Pendientes</h1>
    <ul id="task-list"></ul>

    <script>
        const API_URL = 'http://localhost:8080/tasks';
        const taskList = document.getElementById('task-list');
        let tasks = [];

        fetch(API_URL)
            .then(response => response.json()) 
            .then(data => { 
                tasks = data;
                tasks.forEach(task => {
                    const listItem = document.createElement('li');              
                    listItem.textContent = task.title;
                    if (task.completed) {
                        listItem.classList.add('completed');
                    }
                    taskList.appendChild(listItem);
                });
            });

        async function completeTask(taskId) {
            try {
                const response = await fetch(`${API_URL}/${taskId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}. ¿Está corriendo el servidor Node.js en ${API_URL}?`);
                }

                const taskToUpdate = tasks.find(t => t.id === taskId);
                if (taskToUpdate) {
                    taskToUpdate.completed = true;
                }

            renderTasks(tasks);
                
            } catch (error) {
                console.error('Could not complete task:', error);
                alert(`FALLO: ${error.message}`);
            }
        }

        taskList.addEventListener('click', (event) => {
            const target = event.target;
            if (target.tagName === 'BUTTON' && target.dataset.action === 'complete') {
                const taskId = parseInt(target.dataset.id);
                if (taskId) {
                    completeTask(taskId);
                }
            }
        });
    </script>
  
</body>
</html>
