<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Tareas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }

        .tasks-container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .task-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .task-item {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .task-item:last-child {
            border-bottom: none;
        }

        .task-item.completed {
            background-color: #f8f9fa;
            color: #6c757d;
        }

        .task-checkbox {
            width: 18px;
            height: 18px;
        }

        .task-description {
            flex: 1;
        }

        .task-item.completed .task-description {
            text-decoration: line-through;
        }

        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #f5c6cb;
            margin-bottom: 20px;
        }

        .empty-state {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px 20px;
        }
    </style>
</head>
<body>
    <h1>📝 Mi Lista de Tareas</h1>
    
    <div class="tasks-container">
        <div id="loading-message" class="loading">Cargando tareas...</div>
        
        <div id="error-message" class="error" style="display: none;">
            Error al cargar las tareas. Por favor, intenta nuevamente.
        </div>
        
        <ul id="task-list" class="task-list" style="display: none;"></ul>
        
        <div id="empty-state" class="empty-state" style="display: none;">
            No hay tareas pendientes. ¡Agrega algunas!
        </div>
    </div>

    <script>
        // URL de la API
        const API_URL = 'http://localhost:3000/tasks';

        // Elementos del DOM
        const taskListElement = document.getElementById('task-list');
        const loadingMessage = document.getElementById('loading-message');
        const errorMessage = document.getElementById('error-message');
        const emptyState = document.getElementById('empty-state');

        // Función para mostrar errores
        function showError(message) {
            loadingMessage.style.display = 'none';
            errorMessage.textContent = message || 'Error al cargar las tareas. Por favor, intenta nuevamente.';
            errorMessage.style.display = 'block';
            taskListElement.style.display = 'none';
            emptyState.style.display = 'none';
        }

        // Función para renderizar las tareas
        function renderTasks(tasks) {
            // Ocultar mensaje de carga
            loadingMessage.style.display = 'none';
            
            // Verificar si hay tareas
            if (!tasks || tasks.length === 0) {
                emptyState.style.display = 'block';
                taskListElement.style.display = 'none';
                return;
            }

            // Limpiar lista existente
            taskListElement.innerHTML = '';
            
            // Renderizar cada tarea
            tasks.forEach(task => {
                const taskItem = document.createElement('li');
                taskItem.className = `task-item ${task.completed ? 'completed' : ''}`;
                
                taskItem.innerHTML = `
                    <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''} disabled>
                    <span class="task-description">${escapeHtml(task.description)}</span>
                    <span class="task-id">#${task.id}</span>
                `;
                
                taskListElement.appendChild(taskItem);
            });
            
            // Mostrar la lista
            taskListElement.style.display = 'block';
            emptyState.style.display = 'none';
            errorMessage.style.display = 'none';
        }

        // Función para escapar HTML (prevenir XSS)
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Función principal para cargar tareas
        async function loadTasks() {
            try {
                // Mostrar estado de carga
                loadingMessage.style.display = 'block';
                errorMessage.style.display = 'none';
                taskListElement.style.display = 'none';
                emptyState.style.display = 'none';

                // Hacer la solicitud GET a la API
                const response = await fetch(API_URL, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                // Verificar si la respuesta es exitosa
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status} ${response.statusText}`);
                }

                // Parsear la respuesta JSON
                const tasks = await response.json();
                
                // Renderizar las tareas
                renderTasks(tasks);

            } catch (error) {
                console.error('Error al cargar las tareas:', error);
                
                // Manejar diferentes tipos de errores
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    showError('Error de conexión. Verifica que el servidor esté ejecutándose en http://localhost:3000');
                } else if (error.message.includes('HTTP')) {
                    showError(`Error del servidor: ${error.message}`);
                } else {
                    showError('Error inesperado al cargar las tareas');
                }
            }
        }

        // Cargar las tareas cuando la página se carga
        document.addEventListener('DOMContentLoaded', loadTasks);

        // Opcional: Recargar las tareas cada 30 segundos
        // setInterval(loadTasks, 30000);
    </script>
</body>
</html>